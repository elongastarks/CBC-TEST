
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Connexion - CBC Business</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button { display: block; width: 100%; margin: 10px 0; padding: 10px; }
    #error { color: red; margin-top: 10px; }
    #forgot-link { cursor: pointer; color: blue; text-decoration: underline; }
    .highlight { font-size: 22px; color: red; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body>

  <form onsubmit="login(event)">
    <h2>Connexion</h2>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button type="submit">Se connecter</button>

    <div id="forgot-link" onclick="showReset()">Mot de passe oublié ?</div>
    <div id="reset-area" style="display:none;">
<input type="email" id="reset-email" placeholder="Votre email" />
      <button onclick="resetPassword()">Envoyer lien de réinitialisation</button>
    </div>

    <div id="error"></div>
    <div id="signup-link">Pas encore inscrit ? <a href="signup.html">Créer un compte</a></div>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBla3D7OS8-Hx82m8Tz6ZPIS7FSLury3ew",
      authDomain: "cbc-business.firebaseapp.com",
      projectId: "cbc-business",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    let failCount = 0;

    window.login = async function(event) {
      event.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const errorDiv = document.getElementById("error");

      try {
        await signInWithEmailAndPassword(auth, email, password);
        errorDiv.textContent = "Connexion réussie.";
        window.location.href = "dashboard.html"; // ou autre
} catch (err) {
        failCount++;
        errorDiv.textContent = "Erreur: " + err.message;
        if (failCount >= 3) {
          const forgotLink = document.getElementById("forgot-link");
          forgotLink.classList.add("highlight");
        }
      }
    }

    window.showReset = function() {
      document.getElementById("reset-area").style.display = "block";
    }

    window.resetPassword = async function() {
      const email = document.getElementById("reset-email").value;
      const errorDiv = document.getElementById("error");
      try {
        await sendPasswordResetEmail(auth, email);
        errorDiv.textContent = "Email envoyé. Vérifiez votre boîte.";
      } catch (err) {
        errorDiv.textContent = "Erreur: " + err.message;
      }
    }
  </script>

</body>
</html>
